<script>
    (function () {

        var orig_propertyChanged = Polymer.Dart.InteropBehavior._propertyChanged;
        /*
        Polymer.Dart.InteropBehavior._propertyChanged = function (path, newValue, oldValue) {
            if (this.isAutonotify) {
                return;
            }
            orig_propertyChanged.call(this,path,newValue,oldValue);
        };
*/
        Polymer.Dart.AutoNotify = {
            ignoreNextSplice: false,
            updateJsVersion: function(js) {
              // Placeholder for readability : real one defined in dart
            },
            Behavior: {

                _resolveModel: function(path) {
                    var parts = this._getPathParts(path);
                    var array;

                    // Get the model which is being updated.
                    var thisArg = this;
                    for (var i = 0; i < parts.length - 1; i++) {
                        var part = parts[i];

                        if (array && (parseInt(part) == part)) {
                            thisArg = Polymer.Collection.get(array).getItem(part);
                        } else {
                            thisArg = thisArg[part];
                        }

                        if (!thisArg) {
                            return;
                        }
                        array = Array.isArray(thisArg) ? thisArg : null;
                    }

                    // The property of the model which is being updated.
                    var prop = parts[parts.length - 1];
                    if (array && (parseInt(prop) == prop)) {
                        // Ouch, O(n) operation :(. Also doesn't support duplicates :(.
                        prop = array.indexOf(Polymer.Collection.get(array).getItem(prop));
                    }

                    // Grab the __dartClass__ if we already have one
                    thisArg = thisArg.__dartClass__ || thisArg;
                    return thisArg;
                },

                _propertyChanged: function (path, newValue, oldValue) {
                    if (path.indexOf(".splices",path.length-8) == path.length - 8) {
                        if (Polymer.Dart.AutoNotify.ignoreNextSplice) {
                            newValue._applied = true;
                        } else {
                            Polymer.Dart.AutoNotify.updateJsVersion(this._resolveModel(path));
                        }
                    }
                    Polymer.Dart.InteropBehavior._propertyChanged.call(
                            this, path, newValue, oldValue);
                }
            }
        };
    })();
</script>
